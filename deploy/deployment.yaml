apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
  template:
    metadata:
      labels:
        app: grafana
    spec:
      containers:
        - name: grafana
          image: grafana/grafana:8.0.6
          ports:
            - name: web
              containerPort: 3000
          env:
            - name: GF_SECURITY_ADMIN_USER
              value: admin
            - name: GF_SECURITY_ADMIN_PASSWORD
              value: admin
            - name: MINIO_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: minio-credentials
                  key: accessKey
            - name: MINIO_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: minio-credentials
                  key: secretKey
          volumeMounts:
            - name: minio-storage
              mountPath: /var/lib/grafana
              subPath: grafana # Subdirectory within the MinIO bucket
      volumes:
        - name: minio-storage
          flexVolume:
            driver: "local/minio"
            fsType: ext4
            options:
              endpoint: "https://minio.mamun.cloud:9000" # Replace with your MinIO endpoint
              bucket: "grafana-bucket" # Replace with your MinIO bucket name
---
apiVersion: v1
kind: Service
metadata:
  name: grafana
  labels:
    app: grafana
spec:
  ports:
    - name: web
      port: 3000
      targetPort: 3000
  selector:
    app: grafana
